/*! For license information please see admin_planning_modern.4329404a.js.LICENSE.txt */
"use strict";(self.webpackChunkhtml=self.webpackChunkhtml||[]).push([[390],{1871:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,s=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){s=!0,a=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw a}}return l}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(){var e,t,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function l(n,a,i,o){var l=a&&a.prototype instanceof s?a:s,d=Object.create(l.prototype);return r(d,"_invoke",function(n,r,a){var i,o,l,s=0,d=a||[],u=!1,v={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return i=t,o=0,l=e,v.n=n,c}};function f(n,r){for(o=n,l=r,t=0;!u&&s&&!a&&t<d.length;t++){var a,i=d[t],f=v.p,p=i[2];n>3?(a=p===r)&&(l=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=f&&((a=n<2&&f<i[1])?(o=0,v.v=r,v.n=i[1]):f<p&&(a=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,v.n=p,o=0))}if(a||n>1)return c;throw u=!0,r}return function(a,d,p){if(s>1)throw TypeError("Generator is already running");for(u&&1===d&&f(d,p),o=d,l=p;(t=o<2?e:l)||!u;){i||(o?o<3?(o>1&&(v.n=-1),f(o,l)):v.n=l:v.v=l);try{if(s=2,i){if(o||(a="next"),t=i[a]){if(!(t=t.call(i,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(l=TypeError("The iterator does not provide a '"+a+"' method"),o=1);i=e}else if((t=(u=v.n<0)?l:n.call(r,v))!==c)break}catch(t){i=e,o=1,l=t}finally{s=1}}return{value:t,done:u}}}(n,i,o),!0),d}var c={};function s(){}function d(){}function u(){}t=Object.getPrototypeOf;var v=[][i]?t(t([][i]())):(r(t={},i,function(){return this}),t),f=u.prototype=s.prototype=Object.create(v);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,r(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return d.prototype=u,r(f,"constructor",u),r(u,"constructor",d),d.displayName="GeneratorFunction",r(u,o,"GeneratorFunction"),r(f),r(f,o,"Generator"),r(f,i,function(){return this}),r(f,"toString",function(){return"[object Generator]"}),(n=function(){return{w:l,m:p}})()}function r(e,t,n,a){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}r=function(e,t,n,a){function o(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},r(e,t,n,a)}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n,r,a,i,o){try{var l=e[i](o),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){l(i,r,a,o,c,"next",e)}function c(e){l(i,r,a,o,c,"throw",e)}o(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function d(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,n||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}var u=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=[],this.filteredData=[],this.selectedVehicle=null,this.currentView="week",this.startDate=new Date,this.endDate=new Date(this.startDate.getTime()+5184e5),this.timelineDays=7,this.init()},r=[{key:"init",value:function(){this.setupEventListeners(),this.loadInitialData(),this.renderLegend(),this.generateTimelineDays()}},{key:"setupEventListeners",value:function(){var e=this,t=document.getElementById("planningDate");t&&t.addEventListener("change",function(t){e.startDate=new Date(t.target.value),e.updateEndDate(),e.generateTimelineDays(),e.loadPlanningData()}),document.querySelectorAll(".btn-view").forEach(function(t){t.addEventListener("click",function(t){e.changeView(t.target.dataset.view)})});var n=document.getElementById("vehicleFilter");n&&n.addEventListener("input",function(t){e.filterVehicles(t.target.value)});var r=document.getElementById("resetPlanning");r&&r.addEventListener("click",function(){e.resetPlanning()})}},{key:"updateEndDate",value:function(){"week"===this.currentView?this.endDate=new Date(this.startDate.getTime()+5184e5):this.endDate=new Date(this.startDate.getTime()+25056e5)}},{key:"generateTimelineDays",value:function(){var e=document.querySelector(".timeline-header");if(e){e.innerHTML="";for(var t=new Date(this.startDate),n="week"===this.currentView?7:30,r=0;r<n;r++){var a=document.createElement("div");a.className="timeline-day";var i=t.toLocaleDateString("fr-FR",{weekday:"short"}),o=t.getDate(),l=t.toLocaleDateString("fr-FR",{month:"short"});a.innerHTML="\n                <div>".concat(i.charAt(0).toUpperCase()+i.slice(1),"</div>\n                <div>").concat(o," ").concat(l,"</div>\n            "),e.appendChild(a),t.setDate(t.getDate()+1)}}}},{key:"loadInitialData",value:(l=c(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/planningGeneralData");case 1:return t=e.v,e.n=2,t.json();case 2:this.data=e.v,this.filteredData=a(this.data),this.renderPlanning(),this.renderVehicleList(),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error loading planning data:",r),this.showErrorMessage("Erreur lors du chargement des données de planning");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return l.apply(this,arguments)})},{key:"loadPlanningData",value:(o=c(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/planningGeneralData");case 1:return t=e.v,e.n=2,t.json();case 2:this.data=e.v,this.filteredData=a(this.data),this.renderPlanning(),this.renderVehicleList(),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error loading planning data:",r),this.showErrorMessage("Erreur lors du chargement des données de planning");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return o.apply(this,arguments)})},{key:"changeView",value:function(e){this.currentView=e,this.updateEndDate(),this.generateTimelineDays(),document.querySelectorAll(".btn-view").forEach(function(e){e.classList.remove("active")}),document.querySelector('[data-view="'.concat(e,'"]')).classList.add("active"),this.renderPlanning()}},{key:"filterVehicles",value:function(e){if(e){var t=this.data.filter(function(t){return 0===t.parent&&t.text&&t.text.toLowerCase().includes(e.toLowerCase())}).map(function(e){return e.id});this.filteredData=this.data.filter(function(e){return 0===e.parent||t.includes(e.parent)})}else this.filteredData=a(this.data);this.renderPlanning(),this.renderVehicleList()}},{key:"resetPlanning",value:function(){document.getElementById("vehicleFilter").value="",document.getElementById("planningDate").value=(new Date).toISOString().split("T")[0],this.startDate=new Date,this.updateEndDate(),this.generateTimelineDays(),this.filteredData=a(this.data),this.renderPlanning(),this.renderVehicleList()}},{key:"showErrorMessage",value:function(e){var t=document.createElement("div");t.className="alert alert-danger",t.textContent=e,t.style.position="fixed",t.style.top="20px",t.style.right="20px",t.style.zIndex="9999",document.body.appendChild(t),setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t)},5e3)}},{key:"renderLegend",value:function(){}},{key:"renderVehicleList",value:function(){var e=this,t=document.querySelector(".vehicle-list");if(t){var n=this.filteredData.filter(function(e){return 0===e.parent});t.innerHTML="",n.forEach(function(n){var r=document.createElement("div");r.className="vehicle-item",r.dataset.id=n.id,r.innerHTML="\n                <div>".concat(n.text,'</div>\n                <div style="font-size: 12px; color: #6c757d;">\n                    ').concat(e.getReservationsForVehicle(n.id).length," réservations\n                </div>\n            "),r.addEventListener("click",function(){document.querySelectorAll(".vehicle-item").forEach(function(e){e.classList.remove("selected")}),r.classList.add("selected"),e.selectedVehicle=n.id,e.renderPlanning()}),t.appendChild(r)})}}},{key:"getReservationsForVehicle",value:function(e){return this.filteredData.filter(function(t){return t.parent===e})}},{key:"renderPlanning",value:function(){var e,t=this,n=document.querySelector(".timeline-body");n&&(e=this.selectedVehicle?this.filteredData.filter(function(e){return e.id==t.selectedVehicle&&0===e.parent}):this.filteredData.filter(function(e){return 0===e.parent}),n.innerHTML="",e.forEach(function(e){var r=document.createElement("div");r.className="vehicle-row";var a=document.createElement("div");a.className="vehicle-label",a.textContent=e.text;var i=document.createElement("div");i.className="vehicle-timeline",t.getReservationsForVehicle(e.id).forEach(function(e){var n=t.createReservationElement(e);i.appendChild(n)}),r.appendChild(a),r.appendChild(i),n.appendChild(r)}))}},{key:"createReservationElement",value:function(e){var t=this,n=document.createElement("div");return n.className="reservation-item reservation-".concat(this.getReservationTypeClass(e)),n.dataset.id=e.id_r,this.parseDate(e.start_date),this.parseDate(e.end_date_formated),n.style.left="10px",n.style.width="150px",n.innerHTML='\n            <div class="reservation-content">\n                <div class="reservation-client">'.concat(e.client,'</div>\n                <div class="reservation-dates">').concat(e.start_date_formated," - ").concat(e.end_date_formated,"</div>\n            </div>\n        "),n.addEventListener("click",function(){t.openReservationModal(e)}),n}},{key:"getReservationTypeClass",value:function(e){return"garage"===e.agenceDepart?"garage":e.agenceDepart.includes("Aéroport")?"aeroport":e.agenceDepart.includes("Gare")?"gare":e.agenceDepart.includes("Agence")?"agence":"livraison"}},{key:"parseDate",value:function(e){var n=t(e.split(" "),2),r=n[0],a=n[1],i=t(r.split("-"),3),o=i[0],l=i[1],c=i[2],s=t(a.split(":"),2),d=s[0],u=s[1];return new Date(c,l-1,o,d,u)}},{key:"openReservationModal",value:function(e){var t=document.getElementById("reservationModal");t&&document.body.removeChild(t);var n=document.createElement("div");n.className="modal",n.id="reservationModal",n.innerHTML='\n            <div class="modal-content">\n                <div class="modal-header">\n                    <div class="modal-title">Détails de la réservation</div>\n                    <span class="close">&times;</span>\n                </div>\n                <div class="modal-body">\n                    <div class="form-group">\n                        <label>Référence</label>\n                        <input type="text" class="form-control" value="'.concat(e.reference||"",'" readonly>\n                    </div>\n                    <div class="form-row">\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Client</label>\n                                <input type="text" class="form-control" value="').concat(e.client||"",'" readonly>\n                            </div>\n                        </div>\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Téléphone</label>\n                                <input type="text" class="form-control" value="').concat(e.telClient||"",'" readonly>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Date de départ</label>\n                                <input type="text" class="form-control" value="').concat(e.start_date_formated||"",'" readonly>\n                            </div>\n                        </div>\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Date de retour</label>\n                                <input type="text" class="form-control" value="').concat(e.end_date_formated||"",'" readonly>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Agence de départ</label>\n                                <input type="text" class="form-control" value="').concat(e.agenceDepart||"",'" readonly>\n                            </div>\n                        </div>\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Agence de retour</label>\n                                <input type="text" class="form-control" value="').concat(e.agenceRetour||"",'" readonly>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Tarif véhicule</label>\n                                <input type="text" class="form-control" value="').concat(e.tarifVehicule?e.tarifVehicule+" €":"",'" readonly>\n                            </div>\n                        </div>\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Tarif options/garanties</label>\n                                <input type="text" class="form-control" value="').concat(e.tarifOptionsGaranties?e.tarifOptionsGaranties+" €":"",'" readonly>\n                            </div>\n                        </div>\n                        <div class="form-col">\n                            <div class="form-group">\n                                <label>Tarif total</label>\n                                <input type="text" class="form-control" value="').concat(e.tarifResa?e.tarifResa+" €":"",'" readonly>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="form-group">\n                        <label>Immatriculation</label>\n                        <input type="text" class="form-control" value="').concat(e.immatriculation||"",'" readonly>\n                    </div>\n                </div>\n                <div class="modal-footer" style="text-align: right; padding: 15px; border-top: 1px solid #eee;">\n                    <button type="button" class="btn btn-secondary" id="closeModal">Fermer</button>\n                    <button type="button" class="btn btn-primary" id="editReservation">Modifier</button>\n                </div>\n            </div>\n        '),document.body.appendChild(n),n.querySelectorAll(".close, #closeModal").forEach(function(e){e.addEventListener("click",function(){document.body.contains(n)&&document.body.removeChild(n)})});var r=n.querySelector("#editReservation");r&&r.addEventListener("click",function(){e.id_r&&(window.location.href="/backoffice/reservation/".concat(e.id_r,"/edit/"))}),n.addEventListener("click",function(e){e.target===n&&document.body.contains(n)&&document.body.removeChild(n)}),n.style.display="block"}}],r&&s(e.prototype,r),i&&s(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,i,o,l}();document.addEventListener("DOMContentLoaded",function(){window.modernPlanning=new u})}},e=>{var t;t=1871,e(e.s=t)}]);