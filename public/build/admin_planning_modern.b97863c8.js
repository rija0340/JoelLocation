/*! For license information please see admin_planning_modern.b97863c8.js.LICENSE.txt */
"use strict";(self.webpackChunkhtml=self.webpackChunkhtml||[]).push([[390],{1871:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r,o,l=[],c=!0,s=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=r.call(n)).done)&&(l.push(a.value),l.length!==t);c=!0);}catch(e){s=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw i}}return l}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(){var e,t,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.toStringTag||"@@toStringTag";function l(n,i,r,o){var l=i&&i.prototype instanceof s?i:s,d=Object.create(l.prototype);return a(d,"_invoke",function(n,a,i){var r,o,l,s=0,d=i||[],u=!1,v={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return r=t,o=0,l=e,v.n=n,c}};function f(n,a){for(o=n,l=a,t=0;!u&&s&&!i&&t<d.length;t++){var i,r=d[t],f=v.p,h=r[2];n>3?(i=h===a)&&(l=r[(o=r[4])?5:(o=3,3)],r[4]=r[5]=e):r[0]<=f&&((i=n<2&&f<r[1])?(o=0,v.v=a,v.n=r[1]):f<h&&(i=n<3||r[0]>a||a>h)&&(r[4]=n,r[5]=a,v.n=h,o=0))}if(i||n>1)return c;throw u=!0,a}return function(i,d,h){if(s>1)throw TypeError("Generator is already running");for(u&&1===d&&f(d,h),o=d,l=h;(t=o<2?e:l)||!u;){r||(o?o<3?(o>1&&(v.n=-1),f(o,l)):v.n=l:v.v=l);try{if(s=2,r){if(o||(i="next"),t=r[i]){if(!(t=t.call(r,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,o<2&&(o=0)}else 1===o&&(t=r.return)&&t.call(r),o<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),o=1);r=e}else if((t=(u=v.n<0)?l:n.call(a,v))!==c)break}catch(t){r=e,o=1,l=t}finally{s=1}}return{value:t,done:u}}}(n,r,o),!0),d}var c={};function s(){}function d(){}function u(){}t=Object.getPrototypeOf;var v=[][r]?t(t([][r]())):(a(t={},r,function(){return this}),t),f=u.prototype=s.prototype=Object.create(v);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,a(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return d.prototype=u,a(f,"constructor",u),a(u,"constructor",d),d.displayName="GeneratorFunction",a(u,o,"GeneratorFunction"),a(f),a(f,o,"Generator"),a(f,r,function(){return this}),a(f,"toString",function(){return"[object Generator]"}),(n=function(){return{w:l,m:h}})()}function a(e,t,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}a=function(e,t,n,i){function o(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},a(e,t,n,i)}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function l(e,t,n,a,i,r,o){try{var l=e[r](o),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(a,i)}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,s(a.key),a)}}function s(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,n||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}var d=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=[],this.filteredData=[],this.selectedVehicles=new Set,this.currentView="week",this.startDate=new Date,this.endDate=new Date(this.startDate.getTime()+5184e5),this.timelineWidth=0,this.dayWidth=0,this.init()},a=[{key:"init",value:function(){this.setupEventListeners(),this.calculateTimelineDimensions(),this.loadInitialData()}},{key:"setupEventListeners",value:function(){var e,t,n,a,i=this;document.querySelectorAll(".btn-view").forEach(function(e){e.addEventListener("click",function(){var t=parseInt(e.dataset.days);i.changeView(i.getViewFromDays(t))})}),null===(e=document.getElementById("resetPlanning"))||void 0===e||e.addEventListener("click",function(){return i.resetPlanning()}),null===(t=document.getElementById("vehicleSearch"))||void 0===t||t.addEventListener("input",function(e){i.filterVehicles(e.target.value)}),null===(n=document.getElementById("startDate"))||void 0===n||n.addEventListener("change",function(e){i.changeStartDate(e.target.value)}),window.addEventListener("resize",function(){i.calculateTimelineDimensions(),i.renderPlanning()}),null===(a=document.getElementById("selectAll"))||void 0===a||a.addEventListener("change",function(e){e.target.checked?i.selectAllVehicles():i.selectedVehicles.clear(),i.renderVehicleList(),i.renderPlanning()})}},{key:"getViewFromDays",value:function(e){return{6:"week",13:"fortnight",29:"month",59:"bimonth"}[e]||"week"}},{key:"calculateTimelineDimensions",value:function(){var e=document.querySelector(".planning-content");this.timelineWidth=e?e.clientWidth-200:800;var t=this.getDaysCount();this.dayWidth=this.timelineWidth/t}},{key:"getDaysCount",value:function(){return{week:7,fortnight:14,month:30,bimonth:60}[this.currentView]||7}},{key:"loadInitialData",value:(o=n().m(function e(){var t,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.showLoading(),e.n=1,fetch("/planningGeneralData");case 1:return t=e.v,e.n=2,t.json();case 2:this.data=e.v,this.filteredData=i(this.data),this.selectAllVehicles(),this.renderVehicleList(),this.renderPlanning(),this.hideLoading(),e.n=4;break;case 3:e.p=3,a=e.v,console.error("Error loading planning data:",a),this.hideLoading(),alert("Erreur lors du chargement des données de planning");case 4:return e.a(2)}},e,this,[[0,3]])}),s=function(){var e=this,t=arguments;return new Promise(function(n,a){var i=o.apply(e,t);function r(e){l(i,n,a,r,c,"next",e)}function c(e){l(i,n,a,r,c,"throw",e)}r(void 0)})},function(){return s.apply(this,arguments)})},{key:"changeView",value:function(e){this.currentView=e,this.updateDateRange(),this.calculateTimelineDimensions(),this.renderPlanning(),this.updateActiveButton(e),this.updatePeriodDisplay()}},{key:"updateDateRange",value:function(){var e={week:6,fortnight:13,month:29,bimonth:59}[this.currentView]||6;this.endDate=new Date(this.startDate),this.endDate.setDate(this.startDate.getDate()+e)}},{key:"updatePeriodDisplay",value:function(){var e=document.getElementById("periodText");e&&(e.textContent="Du ".concat(this.startDate.toLocaleDateString("fr-FR")," au ").concat(this.endDate.toLocaleDateString("fr-FR")))}},{key:"changeStartDate",value:function(e){this.startDate=new Date(e),this.updateDateRange(),this.calculateTimelineDimensions(),this.renderPlanning(),this.updatePeriodDisplay()}},{key:"filterVehicles",value:function(e){if(e){var t=this.data.filter(function(t){return 0===t.parent&&t.text&&t.text.toLowerCase().includes(e.toLowerCase())}).map(function(e){return e.id});this.filteredData=this.data.filter(function(e){return 0===e.parent||t.includes(e.parent)})}else this.filteredData=i(this.data);this.renderPlanning(),this.renderVehicleList()}},{key:"resetPlanning",value:function(){document.getElementById("vehicleSearch").value="",document.getElementById("startDate").value=(new Date).toISOString().split("T")[0],this.startDate=new Date,this.currentView="week",this.updateDateRange(),this.calculateTimelineDimensions(),this.selectAllVehicles(),this.filteredData=i(this.data),this.renderPlanning(),this.renderVehicleList(),this.updateActiveButton("week"),this.updatePeriodDisplay()}},{key:"selectAllVehicles",value:function(){var e=this.data.filter(function(e){return 0===e.parent});this.selectedVehicles=new Set(e.map(function(e){return e.id}))}},{key:"toggleVehicleSelection",value:function(e){this.selectedVehicles.has(e)?this.selectedVehicles.delete(e):this.selectedVehicles.add(e),this.renderPlanning(),this.renderVehicleList()}},{key:"updateActiveButton",value:function(e){var t;document.querySelectorAll(".btn-view").forEach(function(e){e.classList.remove("active")}),null===(t=document.querySelector('.btn-view[data-days="'.concat({week:6,fortnight:13,month:29,bimonth:59}[e],'"]')))||void 0===t||t.classList.add("active")}},{key:"renderVehicleList",value:function(){var e=this,t=document.getElementById("vehicleList");if(t){var n=this.filteredData.filter(function(e){return 0===e.parent});t.innerHTML="",n.forEach(function(n){var a=document.createElement("div");a.className="vehicle-item",a.style.height="60px",e.selectedVehicles.has(n.id)&&a.classList.add("selected"),a.dataset.id=n.id;var i=e.getReservationsForVehicle(n.id).length;a.innerHTML='\n                <div class="vehicle-checkbox">\n                    <input type="checkbox" '.concat(e.selectedVehicles.has(n.id)?"checked":"",'>\n                </div>\n                <div class="vehicle-info">\n                    <div class="vehicle-name">').concat(n.text,'</div>\n                    <div class="reservation-count">').concat(i," réservation").concat(1!==i?"s":"","</div>\n                </div>\n            "),a.addEventListener("click",function(t){if("INPUT"!==t.target.tagName){var i=a.querySelector("input");i.checked=!i.checked}e.toggleVehicleSelection(n.id)}),t.appendChild(a)})}}},{key:"getReservationsForVehicle",value:function(e){return this.filteredData.filter(function(t){return t.parent===e})}},{key:"renderPlanning",value:function(){var e=this,t=document.getElementById("timelineHeader"),n=document.getElementById("timelineBody");if(t&&n){this.generateTimelineHeader();var a=this.filteredData.filter(function(t){return 0===t.parent&&e.selectedVehicles.has(t.id)});n.innerHTML="",a.forEach(function(t){var a=document.createElement("div");a.className="vehicle-row",a.style.height="60px";var i=document.createElement("div");i.className="vehicle-label",i.style.width="200px",i.style.lineHeight="60px",i.textContent=t.text;var r=document.createElement("div");r.className="vehicle-timeline",r.style.height="60px",e.getReservationsForVehicle(t.id).forEach(function(t){var n=e.createReservationElement(t);r.appendChild(n)}),a.appendChild(i),a.appendChild(r),n.appendChild(a)})}}},{key:"generateTimelineHeader",value:function(){var e=document.getElementById("timelineHeader");if(e){e.innerHTML="";var t=new Date(this.startDate),n=new Date(this.endDate);for(n.setDate(n.getDate()+1);t<n;){var a=document.createElement("div");a.className="timeline-day",a.style.width="".concat(this.dayWidth,"px"),0!==t.getDay()&&6!==t.getDay()||a.classList.add("weekend");var i=t.toLocaleDateString("fr-FR",{weekday:"short"}),r=t.getDate(),o=t.toLocaleDateString("fr-FR",{month:"short"});a.innerHTML='\n                <div class="day-name">'.concat(i.charAt(0).toUpperCase()+i.slice(1),'</div>\n                <div class="day-date">').concat(r," ").concat(o,"</div>\n            "),e.appendChild(a),t.setDate(t.getDate()+1)}}}},{key:"createReservationElement",value:function(e){var t=this,n=document.createElement("div");n.className="reservation-item reservation-".concat(this.getReservationTypeClass(e)),n.dataset.id=e.id_r;var a=this.parseDate(e.start_date),i=this.parseDate(e.end_date_formated),r=this.calculateReservationPosition(a,i);return n.style.left="".concat(r.left,"px"),n.style.width="".concat(r.width,"px"),n.style.height="40px",n.style.top="10px",n.style.backgroundColor={garage:"#ff9999",aeroport:"#99ccff",gare:"#99ff99",agence:"#ffcc99",livraison:"#cccccc"}[this.getReservationTypeClass(e)],n.innerHTML='\n            <div class="reservation-content">\n                <div class="reservation-client">'.concat(e.client,'</div>\n                <div class="reservation-dates">').concat(e.start_date_formated," - ").concat(e.end_date_formated,"</div>\n            </div>\n        "),n.addEventListener("click",function(a){0===a.button?t.showBookingDetails(e,n):2===a.button&&(a.preventDefault(),t.openReservationModal(e))}),n.addEventListener("contextmenu",function(e){e.preventDefault()}),n}},{key:"showBookingDetails",value:function(e,t){var n=document.querySelector(".booking-details");n&&n.remove();var a=document.createElement("div");a.className="booking-details",a.style.position="absolute",a.style.left="".concat(t.offsetLeft,"px"),a.style.top="".concat(t.offsetTop+t.offsetHeight+5,"px"),a.style.background="#fff",a.style.border="1px solid #ccc",a.style.padding="10px",a.style.zIndex="1000",a.style.maxWidth="300px";var i="/backoffice/reservation/".concat(e.id_r);a.innerHTML='\n            Référence: <a href="'.concat(i,'">').concat(e.reference,"</a><br>\n            Agence de départ: ").concat(e.agenceDepart,"<br>\n            Date de départ: ").concat(e.start_date_formated,"<br>\n            Agence de retour: ").concat(e.agenceRetour,"<br>\n            Date de retour: ").concat(e.end_date_formated,"<br>\n            Téléphone: ").concat(e.telClient,"<br>\n        "),t.parentElement.appendChild(a);var r=function(e){a.contains(e.target)||e.target===t||(a.remove(),document.removeEventListener("click",r))};document.addEventListener("click",r)}},{key:"calculateReservationPosition",value:function(e,t){var n=e.getTime(),a=t.getTime(),i=(n-this.startDate.getTime())/864e5,r=(a-n)/864e5+1;return{left:Math.max(0,i*this.dayWidth),width:Math.max(50,r*this.dayWidth)}}},{key:"getReservationTypeClass",value:function(e){return"garage"===e.agenceDepart?"garage":e.agenceDepart&&e.agenceDepart.includes("Aéroport")?"aeroport":e.agenceDepart&&e.agenceDepart.includes("Gare")?"gare":e.agenceDepart&&e.agenceDepart.includes("Agence")?"agence":"livraison"}},{key:"parseDate",value:function(e){try{var n=t(e.split(" "),2),a=n[0],i=n[1],r=t(a.split("-"),3),o=r[0],l=r[1],c=r[2],s=t(i.split(":"),2),d=s[0],u=s[1];return new Date(c,l-1,o,d,u)}catch(t){return console.error("Error parsing date:",e,t),new Date}}},{key:"openReservationModal",value:function(e){var t,n,a='\n            <div class="modal fade" id="reservationModal" tabindex="-1">\n                <div class="modal-dialog modal-lg">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title">Détails de la réservation</h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                        </div>\n                        <div class="modal-body">\n                            <div class="row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Référence</label>\n                                        <input type="text" class="form-control" value="'.concat(e.reference||"",'" readonly>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Client</label>\n                                        <input type="text" class="form-control" value="').concat(e.client||"",'" readonly>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Téléphone</label>\n                                        <input type="text" class="form-control" value="').concat(e.telClient||"",'" readonly>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Immatriculation</label>\n                                        <input type="text" class="form-control" value="').concat(e.immatriculation||"",'" readonly>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Date de départ</label>\n                                        <input type="text" class="form-control" value="').concat(e.start_date_formated||"",'" readonly>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Date de retour</label>\n                                        <input type="text" class="form-control" value="').concat(e.end_date_formated||"",'" readonly>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Agence de départ</label>\n                                        <input type="text" class="form-control" value="').concat(e.agenceDepart||"",'" readonly>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label>Agence de retour</label>\n                                        <input type="text" class="form-control" value="').concat(e.agenceRetour||"",'" readonly>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="row">\n                                <div class="col-md-4">\n                                    <div class="form-group">\n                                        <label>Tarif véhicule</label>\n                                        <input type="text" class="form-control" value="').concat(e.tarifVehicule?e.tarifVehicule+" €":"",'" readonly>\n                                    </div>\n                                </div>\n                                <div class="col-md-4">\n                                    <div class="form-group">\n                                        <label>Options/Garanties</label>\n                                        <input type="text" class="form-control" value="').concat(e.tarifOptionsGaranties?e.tarifOptionsGaranties+" €":"",'" readonly>\n                                    </div>\n                                </div>\n                                <div class="col-md-4">\n                                    <div class="form-group">\n                                        <label>Tarif total</label>\n                                        <input type="text" class="form-control" value="').concat(e.tarifResa?e.tarifResa+" €":"",'" readonly>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>\n                            <button type="button" class="btn btn-primary" id="editReservationBtn">Modifier</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),i=document.getElementById("reservationModal");i&&i.remove(),document.body.insertAdjacentHTML("beforeend",a),null===(t=document.querySelector("#reservationModal .btn-close"))||void 0===t||t.addEventListener("click",function(){var e;null===(e=document.getElementById("reservationModal"))||void 0===e||e.remove()}),null===(n=document.querySelector("#reservationModal #editReservationBtn"))||void 0===n||n.addEventListener("click",function(){e.id_r&&(window.location.href="/backoffice/reservation/".concat(e.id_r,"/edit/"))}),$("#reservationModal").modal("show"),$("#reservationModal").on("hidden.bs.modal",function(){$(this).remove()})}},{key:"showLoading",value:function(){document.getElementById("loadingOverlay")||document.body.insertAdjacentHTML("beforeend",'\n                <div id="loadingOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; justify-content: center; align-items: center;">\n                    <div style="background: white; padding: 20px; border-radius: 8px;">\n                        <div class="spinner-border text-primary" role="status">\n                            <span class="sr-only">Chargement...</span>\n                        </div>\n                        <div style="margin-top: 10px;">Chargement des données...</div>\n                    </div>\n                </div>\n            ')}},{key:"hideLoading",value:function(){var e=document.getElementById("loadingOverlay");e&&e.remove()}}],a&&c(e.prototype,a),r&&c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,a,r,o,s}();document.addEventListener("DOMContentLoaded",function(){window.modernPlanning=new d})}},e=>{var t;t=1871,e(e.s=t)}]);