{# Template factorisé pour les cartes de réservation #}
{% set config = {
  'devis': {
    'reference_field': 'numero',
    'date_creation_field': 'dateCreation',
    'date_debut_field': 'dateDepart',
    'date_fin_field': 'dateRetour',
    'show_actions': true,
    'actions': ['details', 'download', 'validate']
  },
  'encours': {
    'reference_field': 'reference',
    'date_creation_field': 'dateReservation',
    'date_debut_field': 'dateDebut',
    'date_fin_field': 'dateFin',
    'show_actions': true,
    'actions': ['details']
  },
  'avenir': {
    'reference_field': 'reference',
    'date_creation_field': 'dateReservation',
    'date_debut_field': 'dateDebut',
    'date_fin_field': 'dateFin',
    'show_actions': true,
    'actions': ['details']
  },
  'termine': {
    'reference_field': 'reference',
    'date_creation_field': 'dateReservation',
    'date_debut_field': 'dateDebut',
    'date_fin_field': 'dateFin',
    'show_actions': true,
    'actions': ['details']
  }
} %}

<div
	class="flex flex-wrap gap-6">
	{# flex wrap pour gérer plusieurs cartes en ligne #}
	{% if reservations|length > 0 %}
		{% for reserv in reservations %}
			<div class="bg-white border border-gray-200 shadow-sm hover:shadow-md transition-shadow w-full md:w-5/12">
				{# chaque carte prend environ 48% de largeur #}

				<!-- Image -->
				<figure
					class="h-40 overflow-hidden"> {# réduit largeur à 1/4, hauteur 40 (160px environ) #}
					<img src="{{ vich_uploader_asset(reserv.vehicule, 'imageFile') }}" alt="{{ reserv.vehicule.image }}" class="w-full h-full object-cover">
				</figure>

				<!-- Content -->
				<div
					class="p-4 md:p-6 flex flex-col justify-between w-full">
					{# Nouveau conteneur horizontal entre 2 colonnes #}
					<h2 class="text-xl font-semibold flex items-center">
						{{ attribute(reserv, config[type].reference_field) }}
						<span class="bg-{% if type == 'devis' %}gray-500 text-white{% else %}yellow-500 text-white{% endif %} rounded-full px-2 py-1 text-xs ml-2">{{ config[type].badge_text }}</span>
					</h2>
					<div
						class="flex flex-col md:flex-row gap-6">
						{# Colonne droite : détails #}
						<div class="text-sm text-gray-600">
							<p>
								<i class="fa fa-calendar-alt mr-1 text-joel-red"></i>
								Date création :
								{{ attribute(reserv, config[type].date_creation_field)|date('d/m/Y') }}
							</p>
							<p>
								<i class="fa fa-clock mr-1 text-joel-red"></i>
								Période :
								{{ attribute(reserv, config[type].date_debut_field)|date('d/m/Y') }}
								–
								{{ attribute(reserv, config[type].date_fin_field)|date('d/m/Y') }}
								({{ reserv.duree }}
								jours)
							</p>
							<p>
								<i class="fa fa-car mr-1 text-joel-red"></i>
								Voiture :
								{{ reserv.vehicule.marque }}
								{{ reserv.vehicule.modele }}
							</p>
						</div>
						<div class="flex flex-col gap-2">
							<div class="text-sm ">
								<p>
									<i class="fa fa-money mr-1"></i>
									Prix options :
									{{ reserv.prixOptions }}€</p>
								<p>
									<i class="fa fa-money mr-1"></i>
									Prix garanties :
									{{ reserv.prixGaranties }}€</p>
								<p class="text-base font-bold text-red-500 mt-1">Prix total :
									{{ reserv.prix }}€</p>
							</div>
						</div>


					</div>

					<!-- Bottom: Actions -->
					{% if config[type].show_actions %}
						<div class="mt-4 flex flex-wrap gap-2 justify-end border-t border-gray-200 pt-4">
							{% if 'details' in config[type].actions %}
								<a href="{{ path(type == 'devis' ? 'client_devis_show' : 'client_reservation_show', {'id': reserv.id}) }}" class="border border-gray-300 text-gray-700 hover:bg-gray-100 px-3 py-1.5 rounded-lg text-sm">
									<i class="fa fa-info-circle mr-1"></i>
									Détails
								</a>

							{% endif %}
							{% if 'download' in config[type].actions %}
								<a href="{{ path('devis_pdf', {'hashedId': reserv.id|sha1}) }}" class="border border-gray-300 text-gray-700 hover:bg-gray-100 px-3 py-1.5 rounded-lg text-sm">
									<i class="fa fa-download mr-1"></i>
									Télécharger
								</a>
							{% endif %}
							{% if 'validate' in config[type].actions and (date(attribute(reserv, config[type].date_debut_field)) > date("now") or reserv.transformed == true) %}
								<a href="{{ path('validation_step2', {'id': reserv.id}) }}" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded-lg text-sm">
									<i class="fas fa-check mr-1"></i>
									Valider
								</a>
							{% endif %}
						</div>
					{% endif %}
				</div>
			</div>
		{% endfor %}
	{% else %}
		{% include 'client2/reservation/parts/empty_state.html.twig' with {'type': type} %}
	{% endif %}
</div>
