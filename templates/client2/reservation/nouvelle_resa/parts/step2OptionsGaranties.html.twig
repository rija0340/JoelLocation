<!-- Options Section -->
<div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
	<!-- Header -->
	<div class="border-b border-gray-200 p-6">
		<h3 class="text-2xl font-bold text-joel-red flex items-center">
			<i class="fas fa-plus-circle mr-3 text-joel-red"></i>
			Vos options
		</h3>
		<p class="text-base text-gray-600 mt-2">Personnalisez votre location avec nos options disponibles</p>
	</div>

	<!-- Options Grid -->
	<div class="p-6">
		<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
			<!-- Additional Driver Option -->
			<div class="border border-gray-200 rounded-lg p-6 hover:shadow-sm transition-shadow duration-200">
				<div class="flex flex-col lg:flex-row gap-6">
					<!-- Image -->
					<div class="w-full lg:w-1/3">
						<div class="rounded-lg overflow-hidden bg-gray-100">
							<div class="relative w-full h-40 flex items-center justify-center">
								<picture>
									<source srcset="{{asset('images/options_garanties/CONDUCTEUR_ADDITIONNEL.webp')}}" type="image/webp">
									<img src="{{asset('images/options_garanties/CONDUCTEUR_ADDITIONNEL.png')}}"
										 alt="Conducteur additionnel"
										 loading="lazy"
										 class="w-full h-full object-cover"
										 onerror="this.classList.add('hidden'); this.nextElementSibling.classList.remove('hidden');">
								</picture>
								<div class="hidden absolute inset-0 flex items-center justify-center">
									<i class="fas fa-user-plus text-5xl text-joel-red"></i>
								</div>
							</div>
						</div>
					</div>

					<!-- Content -->
					<div class="w-full lg:w-2/3">
						<h5 class="text-xl font-bold text-joel-red mb-3">Conducteur additionnel</h5>
						<p class="text-base text-gray-700 mb-4 leading-relaxed">
							À Joel Location, nous savons que les longs trajets peuvent être fatigants. Ajoutez un conducteur supplémentaire pour plus de confort et de sécurité.
						</p>
						<div class="flex flex-wrap gap-4">
							<label class="flex items-center gap-3 cursor-pointer bg-white border border-gray-300 rounded-lg px-4 py-3 hover:border-joel-red transition-colors duration-200">
								<input type="radio" name="radio-conducteur" value="true" class="text-joel-red focus:ring-joel-red" {% if devis.conducteur %} checked {% endif %}>
								<span class="text-base font-semibold text-joel-dark">Oui ({{ prixConductSuppl }}€)</span>
							</label>
							<label class="flex items-center gap-3 cursor-pointer bg-white border border-gray-300 rounded-lg px-4 py-3 hover:border-joel-red transition-colors duration-200">
								<input type="radio" name="radio-conducteur" value="false" class="text-joel-red focus:ring-joel-red" {% if devis.conducteur == false %} checked {% endif %}>
								<span class="text-base font-semibold text-joel-dark">Non</span>
							</label>
						</div>
					</div>
				</div>
			</div>

			<!-- Child/Baby Seats Option -->
			<div class="border border-gray-200 rounded-lg p-6 hover:shadow-sm transition-shadow duration-200">
				<div class="flex flex-col lg:flex-row gap-6">
					<!-- Image -->
					<div class="w-full lg:w-1/3">
						<div class="rounded-lg overflow-hidden bg-gray-100">
							<div class="relative w-full h-40 flex items-center justify-center">
								<picture>
									<source srcset="{{asset('images/options_garanties/SIEGE.webp')}}" type="image/webp">
									<img src="{{asset('images/options_garanties/SIEGE.jpg')}}"
										 alt="Siège bébé / enfant"
										 loading="lazy"
										 class="w-full h-full object-cover"
										 onerror="this.classList.add('hidden'); this.nextElementSibling.classList.remove('hidden');">
								</picture>
								<div class="hidden absolute inset-0 flex items-center justify-center">
									<i class="fas fa-child text-5xl text-joel-red"></i>
								</div>
							</div>
						</div>
					</div>

					<!-- Content -->
					<div class="w-full lg:w-2/3">
						<h5 class="text-xl font-bold text-joel-red mb-3">Siège bébé / enfant</h5>
						<p class="text-base text-gray-700 mb-4 leading-relaxed">
							Nous mettons à disposition des sièges homologués NF pour la sécurité de vos enfants.
						</p>
						<div class="space-y-4">
							{% for option in allOptions %}
								{% if option.type == "siège" %}
									{% if option.appelation matches '/Siège/' %}
										<div class="flex flex-col items-start gap-2 bg-white border border-gray-200 rounded-lg p-4">
											<!-- Option Name -->
											<span class="text-base font-medium text-joel-dark">{{ option.appelation }}</span>
											
											<!-- Quantity Controls -->
											<div class="flex items-center border border-gray-300 rounded-lg hover:border-joel-red transition-colors duration-200">
												<button class="text-gray-700 hover:bg-joel-red hover:text-white font-bold px-3 py-2 transition-colors duration-200"
														id="decrement_{{ option.id }}"
														aria-label="Decrement quantity"
														type="button">-</button>
												<input type="number"
													   class="w-16 text-base text-center bg-transparent text-joel-dark border-x border-gray-300 px-2 py-2 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-joel-red transition-all duration-200"
													   name="siege_{{ option.id }}"
													   id="number_{{ option.id }}"
													   value="{% if option.id in devis.devisOptions|map(item => item.opt.id) %}{{ devis.devisOptions|filter(item => item.opt.id == option.id)|first.quantity }}{% else %}0{% endif %}"
													   min="0" max="3" placeholder="0">
												<button class="text-gray-700 hover:bg-joel-red hover:text-white font-bold px-3 py-2 transition-colors duration-200"
														id="increment_{{ option.id }}"
														aria-label="Increment quantity"
														type="button">+</button>
											</div>
											
											<!-- Price -->
											<span class="text-sm font-medium text-joel-red">Prix: {{ option.prix }}€/unité</span>
										</div>
									{% else %}
										<div class="flex flex-col items-start gap-2 bg-white border border-gray-200 rounded-lg p-4">
											<!-- Option Name -->
											<span class="text-base font-medium text-joel-dark">{{ option.appelation }}</span>
											
											<!-- Checkbox -->
											<label class="cursor-pointer flex items-center gap-2">
												<input type="checkbox" name="checkboxOptions[]" value="{{ option.id }}" class="text-joel-red focus:ring-joel-red" {% if option.id in devis.devisOptions|map(item => item.opt.id) %} checked {% endif %}>
												<span class="text-joel-dark">Sélectionner</span>
											</label>
											
											<!-- Price -->
											<span class="text-sm font-medium text-joel-red">Prix: {{ option.prix }}€</span>
										</div>
									{% endif %}
								{% endif %}
							{% endfor %}
						</div>
					</div>
				</div>
			</div>

			<!-- Other Options -->
			{% for option in allOptions %}
				{% set image_url = option.appelation|replace({' : ' : '_',' ': '_'})|lower %}
				{% set image_url = 'images/options_garanties/' ~ image_url ~ '.png'  %}

				{% if option.type != "siège" %}
					<div class="border border-gray-200 rounded-lg p-6 hover:shadow-sm transition-shadow duration-200">
						<div class="flex flex-col lg:flex-row gap-6">
							<!-- Image -->
							<div class="w-full lg:w-1/3">
								<div class="rounded-lg overflow-hidden bg-gray-100">
									<div class="relative w-full h-40 flex items-center justify-center">
										<picture>
											<source srcset="{{asset(image_url|replace({'.png': '.webp', '.jpg': '.webp', '.jpeg': '.webp'}))}}" type="image/webp">
											<img src="{{asset(image_url)}}"
												 alt="{{ option.appelation }}"
												 loading="lazy"
												 class="w-full h-full object-cover"
												 onerror="this.classList.add('hidden'); this.nextElementSibling.classList.remove('hidden');">
										</picture>
										<div class="hidden absolute inset-0 flex items-center justify-center">
											<i class="fas fa-cog text-5xl text-joel-red"></i>
										</div>
									</div>
								</div>
							</div>

							<!-- Content -->
							<div class="w-full lg:w-2/3">
								<h5 class="text-xl font-bold text-joel-red mb-3">{{ option.appelation }}</h5>
								<p class="text-base text-gray-700 mb-4 leading-relaxed">{{ option.description|raw }}</p>
								<label class="flex items-center gap-3 cursor-pointer bg-white border border-gray-200 rounded-lg p-3 hover:border-joel-red transition-colors duration-200">
									<input type="checkbox" name="checkboxOptions[]" value="{{ option.id }}" class="text-joel-red focus:ring-joel-red" {% if option.id in devis.devisOptions|map(item => item.opt.id) %} checked {% endif %}>
									<span class="text-base font-semibold text-joel-dark">{{ option.appelation }} - {{ option.prix }}€</span>
								</label>
							</div>
						</div>
					</div>
				{% endif %}
			{% endfor %}
		</div>
	</div>
</div>

<!-- Guarantees Section -->
<div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden mt-8">
	<!-- Header -->
	<div class="border-b border-gray-200 p-6">
		<h3 class="text-2xl font-bold text-joel-red flex items-center">
			<i class="fas fa-shield-alt mr-3 text-joel-red"></i>
			Vos garanties
		</h3>
		<p class="text-base text-gray-600 mt-2">Protégez votre location avec nos garanties complémentaires</p>
	</div>

	<!-- Guarantees Grid -->
	<div class="p-6">
		<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
			{% for garantie in allGaranties %}
				{% set image_url = garantie.appelation|replace({' & ' : '_',' ' : '_'})|lower %}
				{% if image_url == "assistance_esprit_tranquille"  %}
					{% set image_url = 'images/options_garanties/assitance_esprit_tranquille.png'  %}
				{% else %}
					{% set image_url = 'images/options_garanties/' ~ image_url ~ '.png'  %}
				{% endif %}

				<div class="border border-gray-200 rounded-lg p-6 hover:shadow-sm transition-shadow duration-200">
					<div class="flex flex-col lg:flex-row gap-6">
						<!-- Image -->
						<div class="w-full lg:w-1/3">
							<div class="rounded-lg overflow-hidden bg-gray-100">
								<div class="relative w-full h-40 flex items-center justify-center">
									<picture>
										<source srcset="{{asset(image_url|replace({'.png': '.webp', '.jpg': '.webp', '.jpeg': '.webp'}))}}" type="image/webp">
										<img src="{{asset(image_url)}}"
											 alt="{{ garantie.appelation }}"
											 loading="lazy"
											 class="w-full h-full object-cover"
											 onerror="this.classList.add('hidden'); this.nextElementSibling.classList.remove('hidden');">
									</picture>
									<div class="hidden absolute inset-0 flex items-center justify-center">
										<i class="fas fa-shield-alt text-5xl text-joel-red"></i>
									</div>
								</div>
							</div>
						</div>

						<!-- Content -->
						<div class="w-full lg:w-2/3">
							<h5 class="text-xl font-bold text-joel-red mb-3">{{ garantie.appelation }}</h5>
							<p class="text-base text-gray-700 mb-4 leading-relaxed">{{ garantie.description }}</p>
							<label class="flex items-center gap-3 cursor-pointer bg-white border border-gray-200 rounded-lg p-3 hover:border-joel-red transition-colors duration-200">
								<input type="checkbox" name="checkboxGaranties[]" value="{{ garantie.id }}" class="text-joel-red focus:ring-joel-red" {% if garantie.id in devis.garanties|map(item => item.id) %} checked {% endif %}>
								<span class="text-base font-semibold text-joel-dark">{{ garantie.prix }}€</span>
							</label>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	</div>
</div>

<script>
	// Optimized increment/decrement logic for seat options
document.querySelectorAll('[id^="number_"]').forEach((input) => {
const suffix = input.id.split('_')[1];
const decrementBtn = document.querySelector(`#decrement_${suffix}`);
const incrementBtn = document.querySelector(`#increment_${suffix}`);

decrementBtn.addEventListener('click', (e) => {
e.preventDefault();
const val = parseInt(input.value, 10);
if (val > parseInt(input.min, 10)) {
input.value = val - 1;
}
});

incrementBtn.addEventListener('click', (e) => {
e.preventDefault();
const val = parseInt(input.value, 10);
if (val < parseInt(input.max, 10)) {
input.value = val + 1;
}
});
});
</script>
