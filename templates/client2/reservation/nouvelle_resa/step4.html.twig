{% extends 'baseClient2.html.twig' %}

{% block title %}Réservation
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/client/steps.css') }}">
	<link rel="stylesheet" href="{{ asset('css/client/nouvelleReservation.css') }}">
{% endblock %}


{% block body %}

	<div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0 py-0">
		<div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
			<div>
				<h1 class="text-3xl title-red">Etape 4
				</h1>
				<p class="text-gray-500">Récapitulation de vos choix</p>
			</div>

		</div>

	{% include 'client2/reservation/nouvelle_resa/parts/_step_navigation.html.twig' with { currentStep: 4 } %}

	</div>


	<div class="bg-white shadow mb-8 rounded-lg overflow-hidden">
		<div class="p-6">
			<h2 class="text-2xl font-bold mb-4 flex items-center">
				<i class="fas fa-chevron-right mr-3"></i>
				Votre réservation
			</h2>

			<div
				class="grid grid-cols-1 md:grid-cols-3 gap-6">
				<!-- Vehicle Image -->
				<div class="aspect-video">
					<img src="{{ vich_uploader_asset(devis.vehicule, 'imageFile') }}" alt="{{ devis.vehicule.marque }} {{ devis.vehicule.modele }}" class="w-full h-full object-cover rounded-lg">
				</div>

				<!-- Details Section -->
				<div
					class="md:col-span-2 space-y-4">
					<!-- Agency Info -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
						<div class="bg-gray-100 p-4 rounded-lg">
							<h3 class="text-lg font-semibold mb-2">Agence départ</h3>
							<div class="flex items-start gap-2">
								<i class="fas fa-map-marker-alt mt-1 text-red-500"></i>
								<div>
									<p class="font-medium">{{ devis.agenceDepart }}</p>
									<p class="text-sm text-gray-600">
										{{ devis.dateDepart|date('m/d/Y') }}
										à
										{{ devis.dateDepart|date('H:i') }}
									</p>
								</div>
							</div>
						</div>

						<div class="bg-gray-100 p-4 rounded-lg">
							<h3 class="text-lg font-semibold mb-2">Agence retour</h3>
							<div class="flex items-start gap-2">
								<i class="fas fa-map-marker-alt mt-1 text-red-500"></i>
								<div>
									<p class="font-medium">{{ devis.agenceRetour }}</p>
									<p class="text-sm text-gray-600">
										{{ devis.dateRetour|date('m/d/Y') }}
										à
										{{ devis.dateRetour|date('H:i') }}
									</p>
								</div>
							</div>
						</div>
					</div>

					<!-- Pricing Info -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
						<div class="bg-gray-100 p-4 rounded-lg">
							<p class="mb-2">Soit
								<span class="font-semibold">{{ devis.duree }}</span>
								jours de location</p>
							<h3 class="text-lg font-semibold mb-2">Prix de base de location</h3>
							<p class="text-xl font-bold">{{ devis.tarifVehicule }}
								EUR</p>
							<p class="text-sm text-gray-600">
								soit
								{{ (devis.tarifVehicule / devis.duree)|number_format(2,","," ") }}
								€/jour
							</p>
						</div>

						<div class="bg-gray-100 p-4 rounded-lg">
							<h3 class="text-lg font-semibold mb-2">Prestations incluses</h3>
							<ul class="space-y-1">
								<li class="flex items-start gap-2">
									<i class="fas fa-check-circle text-red-500 mt-1 text-sm"></i>
									<span>Kilométrage Illimité</span>
								</li>
								<li class="flex items-start gap-2">
									<i class="fas fa-check-circle text-red-500 mt-1 text-sm"></i>
									<span>Assurance accidents causés aux tiers</span>
								</li>
								<li class="flex items-start gap-2">
									<i class="fas fa-check-circle text-red-500 mt-1 text-sm"></i>
									<span>Assurance responsabilité civile</span>
								</li>
								<li class="flex items-start gap-2">
									<i class="fas fa-check-circle text-red-500 mt-1 text-sm"></i>
									<span>Assurance collision (CDW)</span>
								</li>
								<li class="flex items-start gap-2">
									<i class="fas fa-check-circle text-red-500 mt-1 text-sm"></i>
									<span>TVA 8.5 %</span>
								</li>
							</ul>
						</div>
					</div>

					<!-- Options & Guarantees -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
						{% if devis.options is not empty or devis.conducteur == true %}
							<div class="bg-gray-100 p-4 rounded-lg">
								<h3 class="text-lg font-semibold mb-2">Options</h3>
								<ul class="space-y-1">
									{% if devis.conducteur == "true" %}
										<li class="flex items-start gap-2">
											<i class="fas fa-plus-circle text-blue-500 mt-1 text-sm"></i>
											<span>Conducteur additionnel : 50€</span>
										</li>
									{% endif %}
									{% for option in devis.devisOptions %}
										<li class="flex items-start gap-2">
											<i class="fas fa-plus-circle text-blue-500 mt-1 text-sm"></i>
											<span>
												{{ option.opt.appelation }}
												(nombre :
												{{ option.quantity }}) :
												{{ (option.opt.prix * option.quantity)|number_format(2,","," ") }}
												€
											</span>
										</li>
									{% endfor %}
								</ul>
							</div>
						{% endif %}

						{% if devis.garanties|length > 0 %}
							<div class="bg-gray-100 p-4 rounded-lg">
								<h3 class="text-lg font-semibold mb-2">Garantie(s)</h3>
								<ul class="space-y-1">
									{% for garantie in devis.garanties %}
										<li class="flex items-start gap-2">
											<i class="fas fa-shield-alt text-yellow-500 mt-1 text-sm"></i>
											<span>{{ garantie.appelation }}
												:
												{{ garantie.prix }}
												€</span>
										</li>
									{% endfor %}
								</ul>
							</div>
						{% endif %}
					</div>

					<!-- Divider -->
					<div class="border-t border-gray-300 my-4"></div>

					<!-- Total & Actions -->
					<div class="flex flex-col md:flex-row justify-between items-center gap-4">
						<div class="text-center md:text-left">
							<p class="text-lg font-semibold">Total à payer :</p>
							<p class="text-3xl font-bold text-red-500">{{ devis.prix }}€</p>
						</div>

						<div class="flex flex-wrap justify-center gap-2">
							<a href="{{ path('client_step3') }}" class="border-2 border-joel-dark text-joel-dark hover:bg-joel-dark hover:text-white px-4 py-2 rounded-lg transition-colors duration-200">
								<i class="fas fa-arrow-left mr-2"></i>
								Revenir à l'étape précédente
							</a>
							<a href="{{ path('client_saveDevis') }}" class="border-2 border-joel-red text-joel-red hover:bg-joel-red hover:text-white px-4 py-2 rounded-lg transition-colors duration-200">
								<i class="fas fa-save mr-2"></i>
								Enregistrer le devis
							</a>
							<a href="{{ path('client_reserverDevis') }}" class="bg-joel-red hover:bg-joel-red-dark text-white px-4 py-2 rounded-lg transition-colors duration-200">
								<i class="fas fa-check mr-2"></i>
								Réserver
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}{% endblock %}
